<html class="js csstransforms3d">
  <head>
    <meta charSet="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>
      FSharp Compiler Service | Notes on FSharp.Core.dll
    </title>
    <link rel="icon" type="image/png" sizes="32x32" href="//fsharp.github.io/FSharp.Compiler.Service/static/images/favicon.png"/>
    <link rel="stylesheet" href="//fsharp.github.io/FSharp.Compiler.Service/static/css/nucleus.css"/>
    <link rel="stylesheet" href="//fsharp.github.io/FSharp.Compiler.Service/static/css/fontawesome-all.min.css"/>
    <link rel="stylesheet" href="//fsharp.github.io/FSharp.Compiler.Service/static/css/hybrid.css"/>
    <link rel="stylesheet" href="//fsharp.github.io/FSharp.Compiler.Service/static/css/featherlight.min.css"/>
    <link rel="stylesheet" href="//fsharp.github.io/FSharp.Compiler.Service/static/css/perfect-scrollbar.min.css"/>
    <link rel="stylesheet" href="//fsharp.github.io/FSharp.Compiler.Service/static/css/auto-complete.css"/>
    <link rel="stylesheet" href="//fsharp.github.io/FSharp.Compiler.Service/static/css/atom-one-dark-reasonable.css"/>
    <link rel="stylesheet" href="//fsharp.github.io/FSharp.Compiler.Service/static/css/theme.css"/>
    <link rel="stylesheet" href="//fsharp.github.io/FSharp.Compiler.Service/static/css/tips.css"/>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.0/styles/atom-one-dark.min.css"/>
    <link rel="stylesheet" href="//fsharp.github.io/FSharp.Compiler.Service/static/css/theme-blue.css"/>
    <script src="//fsharp.github.io/FSharp.Compiler.Service/static/js/jquery-3.3.1.min.js"></script>
  </head>
  <body>
    <nav id="sidebar">
      <div id="header-wrapper">
        <div id="header">
          <h2 id="logo">
            FSharp Compiler Service
          </h2>
        </div>
        <div class="searchbox">
          <label for="search-by">
            <i class="fas fa-search"></i>
          </label>
          <input data-search-input="" id="search-by" type="search" placeholder="Search..."/>
          <span data-search-clear="">
            <i class="fas fa-times"></i>
          </span>
        </div>
        <script type="text/javascript" src="//fsharp.github.io/FSharp.Compiler.Service/static/js/lunr.min.js"></script>
        <script type="text/javascript" src="//fsharp.github.io/FSharp.Compiler.Service/static/js/auto-complete.js"></script>
        <script type="text/javascript">
          var baseurl ='//fsharp.github.io/FSharp.Compiler.Service/'
        </script>
        <script type="text/javascript" src="//fsharp.github.io/FSharp.Compiler.Service/static/js/search.js"></script>
      </div>
      <div class="highlightable">
        <ul class="topics">
          <li id="menu-explanations" class="dd-item menu-group-link">
            <a>
              Explanation
            </a>
          </li>
          <li id="menu-tutorials" class="dd-item menu-group-link">
            <a>
              Tutorials
            </a>
          </li>
          <li id="menu-howtos" class="dd-item menu-group-link menu-group-link-active">
            <a>
              How-To Guides
            </a>
          </li>
          <li id="menu-refs" class="dd-item menu-group-link">
            <a href="//fsharp.github.io/FSharp.Compiler.Service/reference/index.html">
              API Reference
            </a>
          </li>
        </ul>
        <ul id="submenu-explanations" class="submenu">
          <li>
            <a href="//fsharp.github.io/FSharp.Compiler.Service/index.html" class="padding">
              F# Compiler Services
            </a>
          </li>
          <li>
            <a href="//fsharp.github.io/FSharp.Compiler.Service/devnotes.html" class="padding">
              Developer Notes
            </a>
          </li>
        </ul>
        <ul id="submenu-tutorials" class="submenu">
          <li>
            <a href="//fsharp.github.io/FSharp.Compiler.Service/tokenizer.html" class="padding">
              F# Language Tokenizer
            </a>
          </li>
          <li>
            <a href="//fsharp.github.io/FSharp.Compiler.Service/untypedtree.html" class="padding">
              Processing untyped AST
            </a>
          </li>
          <li>
            <a href="//fsharp.github.io/FSharp.Compiler.Service/editor.html" class="padding">
              Editor services
            </a>
          </li>
          <li>
            <a href="//fsharp.github.io/FSharp.Compiler.Service/symbols.html" class="padding">
              Working with symbols
            </a>
          </li>
          <li>
            <a href="//fsharp.github.io/FSharp.Compiler.Service/typedtree.html" class="padding">
              Processing typed expression tree
            </a>
          </li>
          <li>
            <a href="//fsharp.github.io/FSharp.Compiler.Service/project.html" class="padding">
              Project Analysis
            </a>
          </li>
          <li>
            <a href="//fsharp.github.io/FSharp.Compiler.Service/interactive.html" class="padding">
              Embedding F# Interactive
            </a>
          </li>
          <li>
            <a href="//fsharp.github.io/FSharp.Compiler.Service/compiler.html" class="padding">
              Hosted Compiler
            </a>
          </li>
          <li>
            <a href="//fsharp.github.io/FSharp.Compiler.Service/filesystem.html" class="padding">
              Virtualized File System
            </a>
          </li>
          <li>
            <a href="//fsharp.github.io/FSharp.Compiler.Service/react.html" class="padding">
              Reacting to Changes
            </a>
          </li>
        </ul>
        <ul id="submenu-howtos" class="submenu submenu-active">
          <li>
            <a href="//fsharp.github.io/FSharp.Compiler.Service/queue.html" class="padding">
              Notes on the FSharpChecker operations queue
            </a>
          </li>
          <li>
            <a href="//fsharp.github.io/FSharp.Compiler.Service/caches.html" class="padding">
              Notes on the FSharpChecker caches
            </a>
          </li>
          <li>
            <a href="//fsharp.github.io/FSharp.Compiler.Service/corelib.html" class="active-link padding">
              Notes on FSharp.Core.dll
            </a>
          </li>
        </ul>
        <section id="languages">
          <h3>
            Languages
          </h3>
          <ul>
            <li>
              <a href="//fsharp.github.io/FSharp.Compiler.Service/index.html" class="menu-group-link-active padding">
                English
              </a>
            </li>
            <li>
              <a href="//fsharp.github.io/FSharp.Compiler.Service/ja/index.html" class="padding">
                Japanese
              </a>
            </li>
          </ul>
        </section>
        <section id="shortcuts">
          <h3>
            Shortcuts
          </h3>
          <ul>
            <li>
              <a class="padding" href="/">
                <i class="fas fa-home"></i>
                Home
              </a>
            </li>
            <li>
              <a class="padding" href="https://fsharp.org">
                <i class="fas fa-globe"></i>
                F# Software Foundation
              </a>
            </li>
            <li>
              <a class="padding" href="https://github.com/fsharp/FSharp.Compiler.Service">
                <i class="fab fa-github"></i>
                GitHub repo
              </a>
            </li>
            <li>
              <a class="padding" href="https://github.com/fsharp/FSharp.Compiler.Service/blob/master/LICENSE">
                <i class="far fa-file"></i>
                License
              </a>
            </li>
            <li>
              <a class="padding" href="https://github.com/fsharp/FSharp.Compiler.Service/blob/master/RELEASE_NOTES.md">
                <i class="far fa-file-alt"></i>
                Release Notes
              </a>
            </li>
          </ul>
        </section>
        <section id="footer">
          <p>Built with <a href="https://github.com/ionide/Fornax">Fornax</a>
        </section>
      </div>
    </nav>
    <section id="body">
      <div id="overlay"></div>
      <div class="padding highlightable">
        <div id="body-inner">
          <span id="sidebar-toggle-span">
            <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
              <i class="fas fa-bars"></i>
               navigation
            </a>
          </span>
          <h1>Compiler Services: Notes on FSharp.Core.dll</h1>
<h2>Shipping an FSharp.Core with your application</h2>
<p>When building applications or plug-in components which use FSharp.Compiler.Service.dll, you will normally also
include a copy of FSharp.Core.dll as part of your application.</p>
<p>For example, if you build a <code>HostedCompiler.exe</code>, you will normally place an FSharp.Core.dll (say 4.3.1.0) alongside
your <code>HostedCompiler.exe</code>.</p>
<h2>Binding redirects for your application</h2>
<p>The FSharp.Compiler.Service.dll component depends on FSharp.Core 4.4.0.0.  Normally your application will target
a later version of FSharp.Core, and you may need a <a href="https://docs.microsoft.com/en-us/dotnet/framework/configure-apps/redirect-assembly-versions">binding redirect</a> to ensure
that other versions of FSharp.Core forward to the final version of FSharp.Core.dll your application uses.
Binding redirect files are normally generated automatically by build tools. If not, you can use one like this
(if your tool is called <code>HostedCompiler.exe</code>, the binding redirect file is called <code>HostedCompiler.exe.config</code>)</p>
<p>Some other dependencies may also need to be reconciled and forwarded.</p>
<pre class="fssnip highlighted"><code class="language-fsharp"><span class="hljs-keyword">&lt;?</span><span class="hljs-function">xml</span> <span class="hljs-function">version</span><span class="hljs-keyword">=</span><span class="hljs-string">&quot;1.0&quot;</span> <span class="hljs-function">encoding</span><span class="hljs-keyword">=</span><span class="hljs-string">&quot;utf-8&quot;</span> <span class="hljs-keyword">?&gt;</span>
<span class="hljs-keyword">&lt;</span><span class="hljs-function">configuration</span><span class="hljs-keyword">&gt;</span>
    <span class="hljs-keyword">&lt;</span><span class="hljs-function">runtime</span><span class="hljs-keyword">&gt;</span>
      <span class="hljs-keyword">&lt;</span><span class="hljs-function">assemblyBinding</span> <span class="hljs-function">xmlns</span><span class="hljs-keyword">=</span><span class="hljs-string">&quot;urn:schemas-microsoft-com:asm.v1&quot;</span><span class="hljs-keyword">&gt;</span>
        <span class="hljs-keyword">&lt;</span><span class="hljs-function">dependentAssembly</span><span class="hljs-keyword">&gt;</span>
          <span class="hljs-keyword">&lt;</span><span class="hljs-function">assemblyIdentity</span> <span class="hljs-function">name</span><span class="hljs-keyword">=</span><span class="hljs-string">&quot;FSharp.Core&quot;</span> <span class="hljs-function">publicKeyToken</span><span class="hljs-keyword">=</span><span class="hljs-string">&quot;b03f5f7f11d50a3a&quot;</span> <span class="hljs-function">culture</span><span class="hljs-keyword">=</span><span class="hljs-string">&quot;neutral&quot;</span><span class="hljs-keyword">/&gt;</span>
          <span class="hljs-keyword">&lt;</span><span class="hljs-function">bindingRedirect</span> <span class="hljs-function">oldVersion</span><span class="hljs-keyword">=</span><span class="hljs-string">&quot;2.0.0.0-4.4.0.0&quot;</span> <span class="hljs-function">newVersion</span><span class="hljs-keyword">=</span><span class="hljs-string">&quot;4.4.1.0&quot;</span><span class="hljs-keyword">/&gt;</span>
        <span class="hljs-keyword">&lt;/</span><span class="hljs-function">dependentAssembly</span><span class="hljs-keyword">&gt;</span>
        <span class="hljs-keyword">&lt;</span><span class="hljs-function">dependentAssembly</span><span class="hljs-keyword">&gt;</span>
          <span class="hljs-keyword">&lt;</span><span class="hljs-function">assemblyIdentity</span> <span class="hljs-function">name</span><span class="hljs-keyword">=</span><span class="hljs-string">&quot;System.Collections.Immutable&quot;</span> <span class="hljs-function">publicKeyToken</span><span class="hljs-keyword">=</span><span class="hljs-string">&quot;b03f5f7f11d50a3a&quot;</span> <span class="hljs-function">culture</span><span class="hljs-keyword">=</span><span class="hljs-string">&quot;neutral&quot;</span> <span class="hljs-keyword">/&gt;</span>
          <span class="hljs-keyword">&lt;</span><span class="hljs-function">bindingRedirect</span> <span class="hljs-function">oldVersion</span><span class="hljs-keyword">=</span><span class="hljs-string">&quot;1.0.0.0-1.2.0.0&quot;</span> <span class="hljs-function">newVersion</span><span class="hljs-keyword">=</span><span class="hljs-string">&quot;1.2.1.0&quot;</span> <span class="hljs-keyword">/&gt;</span>
        <span class="hljs-keyword">&lt;/</span><span class="hljs-function">dependentAssembly</span><span class="hljs-keyword">&gt;</span>
      <span class="hljs-keyword">&lt;/</span><span class="hljs-function">assemblyBinding</span><span class="hljs-keyword">&gt;</span>
    <span class="hljs-keyword">&lt;/</span><span class="hljs-function">runtime</span><span class="hljs-keyword">&gt;</span>
<span class="hljs-keyword">&lt;/</span><span class="hljs-function">configuration</span><span class="hljs-keyword">&gt;</span>
</code></pre>
<h2>Which FSharp.Core and .NET Framework gets referenced in compilation?</h2>
<p>The FSharp.Compiler.Service component can be used to do more or less any sort of F# compilation.
In particular you can reference an explicit FSharp.Core and/or framework
assemblies in the command line arguments (different to the FSharp.Core and a .NET Framework being used to run your tool).</p>
<p>To target a specific FSharp.Core and/or .NET Framework assemblies, use the <code>--noframework</code> argument
and the appropriate command-line arguments:</p>
<pre class="fssnip highlighted"><code class="language-fsharp"><span class="hljs-keyword">[&lt;</span><span onmouseout="hideTip(event, 'fs1', 1)" onmouseover="showTip(event, 'fs1', 1)" class="hljs-function">Literal</span><span class="hljs-keyword">&gt;]</span>
<span class="hljs-keyword">let</span> <span class="hljs-function">fsharpCorePath</span> <span class="hljs-keyword">=</span>
    <span class="hljs-string">@&quot;C:\Program Files (x86)\Reference Assemblies\Microsoft\FSharp\.NETFramework\v4.0\4.3.1.0\FSharp.Core.dll&quot;</span>
<span class="hljs-keyword">let</span> <span class="hljs-function">errors2</span><span class="hljs-keyword">,</span> <span class="hljs-function">exitCode2</span> <span class="hljs-keyword">=</span>
  <span class="hljs-function">scs</span><span class="hljs-keyword">.</span><span class="hljs-function">Compile</span><span class="hljs-keyword">(</span>
    <span class="hljs-keyword">[|</span> <span class="hljs-string">&quot;fsc.exe&quot;</span><span class="hljs-keyword">;</span> <span class="hljs-string">&quot;--noframework&quot;</span><span class="hljs-keyword">;</span>
       <span class="hljs-string">&quot;-r&quot;</span><span class="hljs-keyword">;</span> <span class="hljs-function">fsharpCorePath</span><span class="hljs-keyword">;</span>
       <span class="hljs-string">&quot;-r&quot;</span><span class="hljs-keyword">;</span> <span class="hljs-string">@&quot;C:\Windows\Microsoft.NET\Framework\v4.0.30319\mscorlib.dll&quot;</span><span class="hljs-keyword">;</span>
       <span class="hljs-string">&quot;-o&quot;</span><span class="hljs-keyword">;</span> <span class="hljs-function">fn3</span><span class="hljs-keyword">;</span>
       <span class="hljs-string">&quot;-a&quot;</span><span class="hljs-keyword">;</span> <span class="hljs-function">fn2</span> <span class="hljs-keyword">|]</span><span class="hljs-keyword">)</span>
</code></pre>
<p>You will need to determine the location of these assemblies.  The easiest way to locate these DLLs in a cross-platform way and
convert them to command-line arguments is to <a href="https://fsharp.github.io/FSharp.Compiler.Service/project.html">crack an F# project file</a>.
Alternatively you can compute SDK paths yourself, and some helpers to do this are in <a href="https://github.com/fsharp/FSharp.Compiler.Service/blob/8a943dd3b545648690cb3bed652a469bdb6dd869/tests/service/Common.fs#L54">the tests for FSharp.Compiler.Service.dll</a>.</p>
<h2>What about if I am processing a script or using <code>GetCheckOptionsFromScriptRoot</code></h2>
<p>If you do <em>not</em> explicitly reference an FSharp.Core.dll from an SDK location, or if you are processing a script
using <code>FsiEvaluationSession</code> or <code>GetCheckOptionsFromScriptRoot</code>, then an implicit reference to FSharp.Core will be made
by the following choice:</p>
<ol>
<li><p>The version of FSharp.Core.dll statically referenced by the host assembly returned by <code>System.Reflection.Assembly.GetEntryAssembly()</code>.</p></li>
<li>
<p>If there is no static reference to FSharp.Core in the host assembly, then</p>
<ul>
<li>For FSharp.Compiler.Service 1.4.0.x above (F# 4.0 series), a reference to FSharp.Core version 4.4.0.0 is added</li>
</ul>
</li>
</ol>
<h2>Do I need to include FSharp.Core.optdata and FSharp.Core.sigdata?</h2>
<p>No, unless you are doing something with very old FSharp.Core.dll.</p>
<h2>Summary</h2>
<p>In this design note we have discussed three things:</p>
<ul>
<li>which FSharp.Core.dll is used to run your compilation tools</li>
<li>how  to configure binding redirects for the FSharp.Core.dll used to run your compilation tools</li>
<li>which FSharp.Core.dll and/or framework assemblies are  referenced during the checking and compilations performed by your tools.</li>
</ul>
<div class="tip" id="fs1">Multiple items<br />type LiteralAttribute =<br />&#160;&#160;inherit Attribute<br />&#160;&#160;new : unit -&gt; LiteralAttribute<br /><br />--------------------<br />new : unit -&gt; LiteralAttribute</div>


        </div>
      </div>
    </section>
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="//fsharp.github.io/FSharp.Compiler.Service/static/js/clipboard.min.js"></script>
    <script src="//fsharp.github.io/FSharp.Compiler.Service/static/js/perfect-scrollbar.min.js"></script>
    <script src="//fsharp.github.io/FSharp.Compiler.Service/static/js/perfect-scrollbar.jquery.min.js"></script>
    <script src="//fsharp.github.io/FSharp.Compiler.Service/static/js/jquery.sticky.js"></script>
    <script src="//fsharp.github.io/FSharp.Compiler.Service/static/js/featherlight.min.js"></script>
    <script src="//fsharp.github.io/FSharp.Compiler.Service/static/js/modernizr.custom-3.6.0.js"></script>
    <script src="//fsharp.github.io/FSharp.Compiler.Service/static/js/learn.js"></script>
    <script src="//fsharp.github.io/FSharp.Compiler.Service/static/js/hugo-learn.js"></script>
    <link rel="stylesheet" href="//fsharp.github.io/FSharp.Compiler.Service/static/mermaid/mermaid.css"/>
    <script src="//fsharp.github.io/FSharp.Compiler.Service/static/mermaid/mermaid.js"></script>
    <script>
      mermaid.initialize({ startOnLoad: true });
    </script>
    <script src="////cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.0/highlight.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.0/languages/fsharp.min.js"></script>
    <script>
      hljs.initHighlightingOnLoad()
    </script>
    <script src="//fsharp.github.io/FSharp.Compiler.Service/static/js/tips.js"></script>
  </body>
</html>